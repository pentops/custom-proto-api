syntax = "proto3";

package j5.sourcedef.v1;

import "google/protobuf/descriptor.proto";
import "j5/schema/v1/schema.proto";
import "j5/sourcedef/v1/annotations.proto";

option go_package = "github.com/pentops/j5/gen/j5/sourcedef/v1/sourcedef_j5pb";

message SourceFile {
  string path = 1;
  string package = 2 [(j5.sourcedef.v1.field).assign = {}];
  string version = 3;

  repeated RootSchema schemas = 4;

  repeated Entity entities = 5;
}

message Entity {
  string name = 1;
  string description = 2;

  Object keys = 3 [(j5.sourcedef.v1.field).block.name = "key"];
  j5.schema.v1.Enum status = 4;
  Object data = 5;
  Oneof events = 6;

  // nonspecific schemas relating to the entity
  RootSchema schemas = 7;
}

message RootSchema {
  oneof type {
    Oneof oneof = 1;
    Object object = 2;
    j5.schema.v1.Enum enum = 3;
  }
}

message Oneof {
  j5.schema.v1.Oneof def = 1;
}

message Object {
  j5.schema.v1.Object def = 1;

  repeated RootSchema schemas = 2;
}
